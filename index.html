<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KENOS PROXX by ig0</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">
    <style>
        /* BASE STYLES & FONT */
        body {
            background-color: black;
            font-family: 'Inter', sans-serif;
            color: white;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            margin: 0;
            overflow: hidden; /* Hide potential scrollbars from snow */
        }

        /* --- Custom B&W Theme Components (from your old file) --- */
        .password-card {
            background-color: rgba(0, 0, 0, 0.8); /* Slightly transparent black */
            border: 1px solid white;
            box-shadow: 0 4px 12px rgba(255, 255, 255, 0.1);
        }

        .input-field {
            background-color: black;
            color: white;
            border: 1px solid white;
            transition: border-color 0.2s;
        }
        .input-field:focus {
            border-color: #5267ff; /* Highlight color */
            outline: none;
        }

        .submit-button {
            background-color: white;
            color: black;
            border: 1px solid white;
            transition: background-color 0.2s, transform 0.1s;
        }
        .submit-button:hover {
            background-color: #ccc;
        }
        .submit-button:active {
            transform: scale(0.98);
        }
        .submit-button-icon {
            background-color: black;
            color: white;
            border: 1px solid white;
            padding: 0.75rem 1.5rem;
        }

        /* --- Snow Effect CSS (from your old file) --- */
        .snowflake {
            position: absolute;
            top: -10px;
            background-color: white;
            border-radius: 50%;
            pointer-events: none;
            animation-timing-function: linear;
            animation-iteration-count: infinite;
            z-index: 1;
        }

        @keyframes fall-left {
            0% { transform: translate(0, 0); opacity: 0.8; }
            50% { opacity: 0.9; }
            100% { transform: translate(-10vw, 100vh); opacity: 0.7; }
        }

        /* --- NEW PROXY AND FULLSCREEN STYLES --- */
        #main-content {
            height: 100vh;
            width: 100%;
            max-width: 900px; /* Constrain the header width */
            padding: 1rem;
            display: none; /* Initially hidden */
            z-index: 10;
        }

        #proxyFrame {
            width: 100%;
            height: 80vh; /* Default height for the iframe */
            border: 1px solid white; /* B&W border for the iframe */
            border-radius: 8px;
            background-color: #000;
            margin-top: 1rem;
            transition: all 0.3s ease;
        }
        
        /* Fullscreen styles */
        .fullscreen-active #proxyFrame {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: 9999;
            margin: 0;
            border-radius: 0;
            border: none;
        }
        .fullscreen-active #main-content {
            display: none; /* Hide the top UI when fullscreen */
        }
    </style>
</head>
<body>

    <div id="snow-container" class="absolute inset-0 z-0"></div>

    <!-- Authentication Screen -->
    <div id="auth-overlay" class="fixed inset-0 flex items-center justify-center z-20 p-4">
        <div class="password-card max-w-sm w-full p-8 rounded-lg shadow-2xl space-y-6">
            <h1 class="text-3xl font-bold text-white text-center tracking-wider">KENOS ACCESS</h1>
            <p class="text-sm text-gray-200 text-center">Enter Access Code to proceed.</p>
            
            <input 
                type="password" 
                id="password-input" 
                placeholder="Access Code" 
                class="input-field w-full p-3 rounded-md focus:ring-1 focus:ring-white focus:outline-none transition"
            >
            <button 
                id="submit-button" 
                onclick="checkPassword()" 
                class="submit-button w-full p-3 rounded-md font-semibold hover:bg-gray-100 transition duration-200"
            >
                ENTER
            </button>
            
            <p id="error-message" class="text-sm text-white text-center hidden pt-2">Invalid code.</p>
        </div>
    </div>

    <!-- Main Application UI (Now contains the proxy input and the iframe) -->
    <div id="main-content" class="flex flex-col mx-auto px-4">
        
        <!-- Header and Input Card -->
        <div class="pt-8 mb-4 flex flex-col items-center">
             <h1 class="text-5xl font-extrabold tracking-widest uppercase mb-2">KENOS PROXX</h1>
             <p class="text-sm text-gray-400 mb-6 uppercase tracking-widest font-semibold">by ig0</p>
            
             <div class="w-full max-w-lg p-3 password-card rounded-lg flex flex-col md:flex-row items-center space-y-3 md:space-y-0 md:space-x-3">
                <input 
                    type="text" 
                    id="proxy-input" 
                    placeholder="e.g., https://example.com" 
                    class="input-field flex-grow p-3 text-base rounded-md"
                    onkeypress="if(event.key === 'Enter') browseProxy()"
                >
                <button 
                    id="proxy-button" 
                    onclick="browseProxy()" 
                    class="submit-button w-full md:w-auto p-3 text-base rounded-md font-semibold hover:bg-gray-100 transition duration-200"
                >
                    BROWSE
                </button>
                <button 
                    onclick="toggleFullscreen()" 
                    id="fullscreen-button" 
                    title="Toggle Fullscreen"
                    class="submit-button-icon w-10 h-10 flex items-center justify-center rounded-md font-semibold hover:bg-gray-100 transition duration-200"
                >
                    <!-- Lucide Fullscreen Icon -->
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"/></svg>
                </button>
            </div>
            <p id="proxy-error" class="text-sm text-white text-center hidden mt-2"></p>
        </div>

        <!-- Iframe Container for Proxied Content -->
        <iframe 
            id="proxyFrame" 
            name="proxyFrame" 
            sandbox="allow-forms allow-scripts allow-same-origin allow-popups allow-modals allow-pointer-lock allow-orientation-lock allow-presentation"
        ></iframe>
    </div>

    <script>
        const CORRECT_PASSWORD = 'qq901';
        const snowContainer = document.getElementById('snow-container');
        const authOverlay = document.getElementById('auth-overlay');
        const mainContent = document.getElementById('main-content');
        const passwordInput = document.getElementById('password-input');
        const errorMessage = document.getElementById('error-message');
        const iframe = document.getElementById('proxyFrame');
        const body = document.body;

        // --- AUTHENTICATION LOGIC ---

        function checkPassword() {
            const enteredPassword = passwordInput.value;
            if (enteredPassword === CORRECT_PASSWORD) {
                authOverlay.classList.add('hidden');
                mainContent.style.display = 'flex'; // Show the main UI
                errorMessage.classList.add('hidden');
            } else {
                errorMessage.classList.remove('hidden');
                passwordInput.value = '';
                passwordInput.focus();
            }
        }
        
        passwordInput.addEventListener('keypress', function(event) {
            if (event.key === 'Enter') {
                checkPassword();
            }
        });

        // --- PROXY BROWSING LOGIC (Now uses IFRAME) ---

        function browseProxy() {
            const input = document.getElementById('proxy-input');
            const url = input.value.trim();
            const errorElement = document.getElementById('proxy-error');
            errorElement.classList.add('hidden');
            errorElement.textContent = '';

            if (url === "") {
                errorElement.textContent = 'Please enter a URL.';
                errorElement.classList.remove('hidden');
                return;
            }

            let targetUrl = url;

            // Simple protocol correction
            if (!targetUrl.startsWith('http://') && !targetUrl.startsWith('https://')) {
                targetUrl = 'https://' + targetUrl;
            }
            
            // Encode the URL and construct the worker path expected by Cloudflare Pages routing
            const encodedUrl = encodeURIComponent(targetUrl);
            
            // This path MUST match the route you set up on Cloudflare (e.g., yourdomain.com/proxx/*)
            const proxyUrl = window.location.origin + `/proxx/${encodedUrl}`;

            // Load the result into the iframe instead of redirecting the whole window
            iframe.src = proxyUrl;
        }

        // --- FULLSCREEN LOGIC (NEW) ---

        function toggleFullscreen() {
            if (!document.fullscreenElement) {
                // Request fullscreen on the entire body
                body.requestFullscreen().catch(err => {
                    console.error(`Error attempting to enable fullscreen: ${err.message}`);
                    // Fallback message box
                    const messageBox = document.createElement('div');
                    messageBox.style.cssText = 'position:fixed; top:50%; left:50%; transform:translate(-50%,-50%); background:red; color:white; padding:15px; border-radius:8px; z-index:10000;';
                    messageBox.textContent = 'Fullscreen failed. Browser security settings may block it.';
                    document.body.appendChild(messageBox);
                    setTimeout(() => messageBox.remove(), 3000);
                });
            } else {
                document.exitFullscreen();
            }
        }

        // Update body class when fullscreen state changes
        document.addEventListener('fullscreenchange', () => {
            if (document.fullscreenElement) {
                body.classList.add('fullscreen-active');
            } else {
                body.classList.remove('fullscreen-active');
            }
        });


        // --- Snow Effect Initialization (from your old file) ---

        /** Creates a single snowflake with randomized properties. */
        function createSnowflake() {
            const snowflake = document.createElement('div');
            snowflake.classList.add('snowflake');

            snowflake.style.left = Math.random() * window.innerWidth + 'px';
            snowflake.style.opacity = 0.5 + Math.random() * 0.5;
            
            const size = (4 + Math.random() * 3);
            snowflake.style.width = size + 'px';
            snowflake.style.height = size + 'px';

            snowflake.style.animationDuration = (8 + Math.random() * 7) + 's'; // 8s to 15s fall time
            snowflake.style.animationDelay = -Math.random() * 10 + 's'; // Start off-screen

            snowflake.style.animationName = 'fall-left';
            
            snowContainer.appendChild(snowflake);

            // Clean up and re-create the flake once it falls off-screen
            snowflake.addEventListener('animationend', () => { 
                snowflake.remove(); 
                createSnowflake();
            });
        }

        /** Initializes the snow effect. */
        function initSnow() {
            const flakeCount = 100;
            for (let i = 0; i < flakeCount; i++) {
                createSnowflake();
            }
        }

        // Ensure the snow starts when the page loads
        window.onload = function () {
            initSnow();
        }

        // Simple cleanup on resize (optional, but handles landscape orientation changes better)
        window.addEventListener('resize', () => {
            snowContainer.innerHTML = '';
            initSnow();
        });
    </script>
</body>
</html>
